<%

require "json"

def esc(x)
    case x
    when String
        x.to_json[1..-2]
    else
        x.to_json.to_json[1..-2]
    end
end

tcp_port = case p("mongodb.node_role")
    when "rs"
        p("mongodb.rs_port")
    when "sh"
        p("mongodb.sh_port")
    when "cfg"
        p("mongodb.cfg_port")
    when "mongos"
        p("mongodb.mongos_port")
end
-%>
rs.initiate({
    _id : "<%= esc(p('mongodb.replication.replica_set_name')) %>",
    members: [
        {
            _id: 0,
            host: "<%= esc(spec.ip) %>:<%= esc(tcp_port) %>"
        }
    ]
});